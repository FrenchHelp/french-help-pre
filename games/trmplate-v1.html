<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Page | French Help For School</title>
    <!-- Favicon and icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicons/favicon-16x16.png">
    <link rel="manifest" href="../assets/favicons/site.webmanifest">

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: sans-serif;
        }

        #game-container {
            height: 100%;
            width: 100%;
            position: relative;
        }

        iframe {
            border: none;
            height: 100%;
            width: 100%;
        }

        /* Menu bar */
        #menu-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px 0;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        #menu-bar.hidden {
            opacity: 0;
            pointer-events: none;
        }



        .menu-icon {
            height: 20px;
            margin: 0 20px;
            cursor: pointer;
        }

        #menu-toggle {
            position: absolute;
            top: 05px;
            right: 20px;
            height: 20px;
            z-index: 11;
            cursor: pointer;
            background-color: #333;
            padding: 5px;
            border-radius: 5px;

        }

        /* Not logged in styling */
        .not-logged-in {
            text-align: center;
            font-size: 100px;
            font-weight: bold;
            background: linear-gradient(120deg, rgba(2, 0, 36, 1) 0%, rgba(9, 9, 121, 1) 35%, rgba(0, 212, 255, 1) 100%);
            color: white;
            padding: 50px;
            height: 100vh;
            overflow: hidden;
            text-shadow: 2px 2px 5px black;
        }

        .not-logged-in h1 {
            font-size: 100px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 5px black;
        }

        .not-logged-in p {
            font-size: 20px;
            margin-top: 20px;
        }

        .not-logged-in a {
            color: black;
            text-decoration: none;
            font-size: 15px;
        }

        .not-logged-in button {
            background-color: #f0f0f0;
            border-radius: 10px;
            padding: 10px 50px;
            border: none;
            outline: none;
            box-shadow: 2px 2px 5px black;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
        }

        .not-logged-in button:hover {
            background-color: #e0e0e0;
        }
    </style>
</head>

<body>

    <div id="not-logged-in" class="not-logged-in" style="display:none;">
        <h1>404</h1>
        <p>This page does not exist. Please check the url or Log In</p>
        <button><a href="../login.html">Log In</a></button>
    </div>

    <div id="game-container" style="display:none;">
        <!-- Menu Toggle Icon -->
        <img id="menu-toggle" src="../assets/icons/menu.png" alt="Menu Toggle" />

        <!-- Menu Bar -->
        <div id="menu-bar">
            <a href="../user.html"><img src="../assets/icons/arrow.png" class="menu-icon" title="Back"></a>
            <a href="../index.html"><img src="../assets/icons/home.png" class="menu-icon" title="Home"></a>
            <img src="../assets/icons/fullscreen.png" class="menu-icon" id="fullscreen-btn" title="Fullscreen">
            <img src="../assets/icons/share.png" class="menu-icon" id="share-btn" title="Share">
            <img src="../assets/icons/volume.png" class="menu-icon" id="volume-btn" title="Toggle Mute">
            <img src="../assets/icons/tab.png" class="menu-icon" id="popup-btn" title="Open in about:blank">

        </div>

        <!-- Game Frame -->
        <iframe id="game-frame" src="https://example.com"></iframe>
    </div>

    <script>
        // Check login status
        const isLoggedIn = localStorage.getItem("french_logged_in") === "Nf9qNFv9wLTHdvWrvgI0Sb89Tyysbj6r";
        const gameContainer = document.getElementById("game-container");
        const notLoggedIn = document.getElementById("not-logged-in");

        if (isLoggedIn) {
            gameContainer.style.display = "block";
        } else {
            notLoggedIn.style.display = "block";
        }

        // Menu toggle
        const menuBar = document.getElementById("menu-bar");
        const menuToggle = document.getElementById("menu-toggle");
        let menuVisible = true;

        menuToggle.addEventListener("click", () => {
            menuVisible = !menuVisible;
            menuBar.classList.toggle("hidden", !menuVisible);
        });

        // Fullscreen toggle
        document.getElementById("fullscreen-btn").addEventListener("click", () => {
            const iframe = document.getElementById("game-frame");
            if (iframe.requestFullscreen) iframe.requestFullscreen();
            else if (iframe.webkitRequestFullscreen) iframe.webkitRequestFullscreen();
            else if (iframe.msRequestFullscreen) iframe.msRequestFullscreen();
        });

        // Share button
        document.getElementById("share-btn").addEventListener("click", async () => {
            try {
                await navigator.share({
                    title: document.title,
                    url: window.location.href
                });
            } catch (e) {
                alert("Sharing not supported on this device.");
            }
        });

        // Mute toggle
        const volumeBtn = document.getElementById("volume-btn");
        let isMuted = false;

        volumeBtn.addEventListener("click", () => {
            const iframe = document.getElementById("game-frame");
            const iframeWindow = iframe.contentWindow;

            // You can only mute if the game is your own content or you control its media
            // Here we simulate mute toggle by swapping icons
            isMuted = !isMuted;
            volumeBtn.src = isMuted ? "../resources/icons/mute.png" : "../resources/icons/volume.png";

            // Optional: post message to iframe to mute, if supported
            // iframeWindow.postMessage({ type: "TOGGLE_MUTE", muted: isMuted }, "*");
        });

        // Open in new tab
        // Pop out current page in about:blank with iframe
        document.getElementById("popup-btn").addEventListener("click", () => {
            const currentUrl = window.location.href;
            const sitePref = localStorage.getItem("french_sitepref") || "../index.html";

            // Open about:blank popup
            const win = window.open("about:blank");
            win.document.write(`
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <title>about:blank</title>
            <style>
                html, body {
                    margin: 0;
                    padding: 0;
                    height: 100%;
                    overflow: hidden;
                    background: #000;
                }
                iframe {
                    border: none;
                    width: 100%;
                    height: 100%;
                }
            </style>
        </head>
        <body>
            <iframe src="${currentUrl}"></iframe>
        </body>
        </html>
    `);
            win.document.close();

            // Redirect current tab
            window.location.href = sitePref;
        });
    </script>

</body>

</html>